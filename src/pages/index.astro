---
// Layout import
import BaseLayout from '../layouts/BaseLayout.astro';

// Component Imports
import Hero from '../components/Hero.astro';
import AboutSection from '../components/AboutSection.astro';
import SkillsList from '../components/SkillsList.astro';
import WorksSection from '../components/WorksSection.astro';
---

<BaseLayout>
	<div class="bg-circles"></div>

	<div class="hero-wrapper">
		<header class="hero">
			<Hero
				title="Kengo Hoi"
				tagline="Welcome to my portfolio!"
				align="center"
			>
			</Hero>
		</header>
	</div>

	<div class="page-spacing">
		<div class="stack gap-30 lg:gap-24">

			<AboutSection />
			<SkillsList />
			<WorksSection />

		</div>
	</div>
</BaseLayout>

<script type="module">
  document.addEventListener("DOMContentLoaded", () => {
    // === 背景円のアニメーション ===
    const container = document.querySelector(".bg-circles");
    const NUM = 20;

    for (let i = 0; i < NUM; i++) {
      const el = document.createElement("div");
      el.classList.add("bg-circle");
      const size = Math.random() * 200 + 50;
      el.style.width = `${size}px`;
      el.style.height = `${size}px`;
      el.style.left = `${Math.random() * 100}%`;
      el.style.top = `${Math.random() * 100}%`;
      el.style.backgroundColor = `rgba(190, 160, 230, ${Math.random() * 0.2 + 0.05})`;
      container.appendChild(el);
    }

    // スクロール時のアニメーション
    window.addEventListener("scroll", () => {
      const scrollY = window.scrollY;
      document.querySelectorAll(".bg-circle").forEach((c, idx) => {
        const speed = (idx % 5 + 1) * 0.1; // 円ごとに異なる速度
        c.style.transform = `translateY(-${scrollY * speed}px)`;
      });
    });

    // === Scroll Reveal Animation ===
    const observerOptions = {
        root: null,
        rootMargin: '0px 0px -10% 0px', // 画面の下端から10%内側に入るまで反応させない
        threshold: 0.2 // 要素の20%が画面内に入った時にトリガー
    };

    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('in-view');
                observer.unobserve(entry.target); // 一度表示されたら監視終了
            }
        });
    }, observerOptions);

    const elements = document.querySelectorAll('.scroll-reveal');
    elements.forEach(el => observer.observe(el));
  });
</script>

<style>
	/* 垂直中央揃えを完璧にするためのリセット */
	:global(.hero h1) {
		margin-bottom: 0 !important;
		font-size: clamp(3rem, 10vw, 5rem) !important; /* 画面幅に応じて可変（最小3rem〜最大5rem） */
		line-height: 1.1;
	}
	@media (min-width: 50em) {
		:global(.hero h1) {
			font-size: 5rem !important; /* PC表示ではさらに巨大に */
		}
	}

	:global(.hero .tagline) {
		margin-top: 1rem !important; /* サイズ拡大に合わせて間隔も少し調整 */
		font-size: var(--text-lg) !important;
	}

	@media (min-width: 50em) {
		:global(.hero .tagline) {
			font-size: var(--text-xl) !important;
		}
	}

	.hero-wrapper {
		/* 通常フローに戻すことで重なりを物理的に排除 */
		min-height: 100vh;
		min-height: 112dvh;
		
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		
		/* Navバーの分だけ上を空けて、視覚的な重心を下げる */
		padding-top: 8rem; 
		padding-bottom: 8rem; /* 上下対称 */
		padding-inline: 1.5rem;
		box-sizing: border-box;
		
		/* z-index は不要 */
	}

	.hero {
		display: flex;
		flex-direction: column;
		align-items: center;
		/* gap は Hero コンポーネント内部で制御されるため、ここでは不要か最小限に */
	}

	.roles {
		display: none;
	}

	.hero img {
		aspect-ratio: 5 / 4;
		object-fit: cover;
		object-position: top;
		border-radius: 1.5rem;
		box-shadow: var(--shadow-md);
	}

	@media (min-width: 50em) {
		.hero {
			display: grid;
			grid-template-columns: 1fr;
			padding-inline: 2.5rem;
			gap: 3.75rem;
		}

		.roles {
			margin-top: 0.5rem;
			display: flex;
			gap: 0.5rem;
		}

		.hero img {
			aspect-ratio: 3 / 4;
			border-radius: 4.5rem;
			object-fit: cover;
		}
	}

	.page-spacing {
		/* padding-block は各セクションの .section-space で確保されているため削除 */
	}
	/* PC用メディアクエリ内も削除 */
	@media (min-width: 50em) {
		/* .page-spacing { padding-block: 12rem; } 削除 */
	}

	/* 背景円全体ラッパー */
	.bg-circles {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		overflow: hidden;
		pointer-events: none;
		z-index: -1;
	}

	.bg-circle {
		position: absolute;
		border-radius: 50%;
		will-change: transform;
		transition: transform 0.1s linear;
	}
</style>